export type CharacterFormat = {
    padding: number;
    width: number;
    formatString: string;
    formatValues: Array<number>;
};

const CharacterFormatMap: { [key: string]: CharacterFormat } = {
    '0': {
        padding: 2.8755,
        width: 48.256,
        formatString:
            ' M  {}  64.576  C  {}  64.576  {}  53.824  {}  40.256  C  {}  26.624  {}  16.896  {}  16.896  C  {}  16.896  {}  26.624  {}  40.256  C  {}  53.824  {}  64.576  {}  64.576  Z  M  {}  40.64  C  {}  49.6  {}  56.448  {}  56.448  C  {}  56.448  {}  49.6  {}  40.64  C  {}  31.68  {}  25.088  {}  25.088  C  {}  25.088  {}  31.68  {}  40.64  Z ',
        formatValues: [
            27.0035, 40.5715, 51.1315, 51.1315, 51.1315, 40.5715, 27.0035,
            13.3715, 2.8755, 2.8755, 2.8755, 13.3715, 27.0035, 42.9395, 42.9395,
            37.1795, 26.9395, 16.7635, 11.0035, 11.0035, 11.0035, 16.7635,
            27.0035, 37.1155, 42.9395, 42.9395,
        ],
    },
    '1': {
        padding: 1.7235,
        width: 19.072,
        formatString:
            ' M  {}  64  V  32.704  C  {}  23.104  {}  17.472  {}  17.472  H  {}  V  25.6  H  {}  C  {}  25.6  {}  28.096  {}  32.704  V  64  H  {}  Z ',
        formatValues: [
            20.7955, 20.7955, 15.5475, 6.2035, 1.7235, 6.2035, 10.4275, 12.7315,
            12.7315, 20.7955,
        ],
    },
    '2': {
        padding: 4.12575,
        width: 45.44005,
        formatString:
            ' M  {}  64  V  55.872  H  {}  V  49.792  C  {}  45.824  {}  43.776  {}  43.776  H  {}  C  {}  43.776  {}  38.208  {}  30.528  C  {}  23.04  {}  17.472  {}  17.472  H  {}  V  25.6  H  {}  C  {}  25.6  {}  27.776  {}  31.296  C  {}  34.816  {}  36.928  {}  36.928  H  {}  C  {}  36.928  {}  41.344  {}  50.368  V  64  H  {}  Z ',
        formatValues: [
            48.7978, 11.8058, 11.8058, 14.1098, 18.4618, 35.3577, 44.1898,
            49.5658, 49.5658, 49.5658, 44.5098, 35.2938, 4.50975, 35.2938,
            38.9418, 41.1818, 41.1818, 41.1818, 38.8138, 35.2938, 18.4618,
            9.11775, 4.12575, 4.12575, 48.7978,
        ],
    },
    '3': {
        padding: 2.97525,
        width: 46.84805,
        formatString:
            ' M  {}  64  C  {}  64  {}  58.368  {}  49.92  C  {}  44.48  {}  40.768  {}  39.424  C  {}  38.336  {}  35.392  {}  29.504  C  {}  21.568  {}  17.472  {}  17.472  H  {}  V  25.536  H  {}  C  {}  25.536  {}  27.008  {}  31.296  C  {}  35.328  {}  36.928  {}  36.928  H  {}  V  43.776  H  {}  C  {}  43.776  {}  45.888  {}  49.728  C  {}  53.76  {}  55.872  {}  55.872  H  {}  V  64  H  {}  Z ',
        formatValues: [
            34.8473, 43.9353, 49.8233, 49.8233, 49.8233, 46.7513, 42.5273,
            45.9833, 48.9273, 48.9273, 48.9273, 42.9753, 33.9513, 3.16725,
            32.3512, 37.7273, 40.7353, 40.7353, 40.7353, 38.5593, 33.9513,
            13.9833, 34.5273, 39.0713, 41.5673, 41.5673, 41.5673, 37.9833,
            32.8633, 2.97525, 34.8473,
        ],
    },
    '4': {
        padding: 3.54075,
        width: 49.40805,
        formatString:
            ' M  {}  64  V  51.584  H  {}  V  43.776  H  {}  V  17.472  H  {}  V  43.776  H  {}  C  {}  43.776  {}  41.984  {}  36.608  V  17.472  H  {}  V  36.672  C  {}  46.976  {}  51.584  {}  51.584  H  {}  V  64  H  {}  Z ',
        formatValues: [
            46.2288, 52.9488, 46.2288, 38.1007, 18.8368, 13.9728, 11.6688,
            11.6688, 3.54075, 3.54075, 9.10875, 18.8368, 38.1007, 46.2288,
        ],
    },
    '5': {
        padding: 4.2195,
        width: 49.28,
        formatString:
            ' M  {}  64  C  {}  64  {}  58.176  {}  50.368  C  {}  41.344  {}  36.928  {}  36.928  H  {}  V  25.6  H  {}  V  17.472  H  {}  V  43.776  H  {}  C  {}  43.776  {}  45.824  {}  49.792  C  {}  53.44  {}  55.872  {}  55.872  H  {}  V  64  H  {}  Z ',
        formatValues: [
            39.0995, 48.7635, 53.4995, 53.4995, 53.4995, 48.4435, 39.0995,
            12.6035, 51.2595, 4.2195, 39.0995, 43.3875, 45.8195, 45.8195,
            45.8195, 43.4515, 39.0995, 4.2195, 39.0995,
        ],
    },
    '6': {
        padding: 2.78175,
        width: 49.72805,
        formatString:
            ' M  {}  64  C  {}  64  {}  58.88  {}  49.856  C  {}  40.896  {}  36.864  {}  36.864  H  {}  C  {}  28.992  {}  25.6  {}  25.6  H  {}  V  17.472  H  {}  C  {}  17.472  {}  24.384  {}  40.256  C  {}  56.192  {}  64  {}  64  H  {}  Z  M  {}  43.776  C  {}  43.776  {}  45.696  {}  49.536  C  {}  53.568  {}  55.872  {}  55.872  H  {}  C  {}  55.872  {}  52.16  {}  43.776  H  {}  Z ',
        formatValues: [
            38.3658, 47.1338, 52.5098, 52.5098, 52.5098, 47.2618, 38.3658,
            11.1018, 12.1258, 16.5417, 23.9018, 50.5898, 23.9018, 10.7818,
            2.78175, 2.78175, 2.78175, 10.7818, 23.9018, 38.3658, 37.5978,
            42.2698, 44.7018, 44.7018, 44.7018, 42.2058, 37.5978, 23.9018,
            16.3498, 11.8698, 11.0378, 37.5978,
        ],
    },
    '7': {
        padding: 3.1285,
        width: 44.224,
        formatString:
            ' M  {}  64  L  {}  25.152  C  {}  23.616  {}  22.528  {}  21.312  C  {}  19.2  {}  17.472  {}  17.472  H  {}  V  25.6  H  {}  L  {}  64  H  {}  Z ',
        formatValues: [
            14.0725, 45.8165, 47.0965, 47.3525, 47.3525, 47.3525, 45.8805,
            42.2325, 3.1285, 35.3205, 3.5125, 14.0725,
        ],
    },
    '8': {
        padding: 3.514,
        width: 50.944,
        formatString:
            ' M  {}  64  C  {}  64  {}  58.432  {}  49.92  C  {}  44.48  {}  40.768  {}  39.424  C  {}  38.336  {}  35.392  {}  29.504  C  {}  21.568  {}  17.472  {}  17.472  H  {}  C  {}  17.472  {}  21.568  {}  29.504  C  {}  35.392  {}  38.336  {}  39.424  C  {}  40.768  {}  44.48  {}  49.92  C  {}  58.432  {}  64  {}  64  H  {}  Z  M  {}  43.776  C  {}  43.776  {}  45.952  {}  49.792  C  {}  53.824  {}  55.872  {}  55.872  H  {}  C  {}  55.872  {}  53.824  {}  49.792  C  {}  45.952  {}  43.776  {}  43.776  H  {}  Z  M  {}  25.536  C  {}  25.536  {}  27.008  {}  31.296  C  {}  35.328  {}  36.928  {}  36.928  H  {}  C  {}  36.928  {}  35.328  {}  31.296  C  {}  27.008  {}  25.536  {}  25.536  H  {}  Z ',
        formatValues: [
            39.482, 48.57, 54.458, 54.458, 54.458, 51.386, 47.162, 50.618,
            53.626, 53.626, 53.626, 47.61, 38.586, 19.386, 10.362, 4.41, 4.41,
            4.41, 7.354, 10.81, 6.586, 3.514, 3.514, 3.514, 9.402, 18.49,
            39.482, 39.162, 43.706, 46.266, 46.266, 46.266, 42.618, 37.498,
            20.474, 15.354, 11.706, 11.706, 11.706, 14.266, 18.81, 39.162,
            37.05, 42.362, 45.37, 45.37, 45.37, 43.194, 38.586, 19.386, 14.778,
            12.602, 12.602, 12.602, 15.61, 20.922, 37.05,
        ],
    },
    '9': {
        padding: 3.1255,
        width: 49.728,
        formatString:
            ' M  {}  64  C  {}  64  {}  57.088  {}  41.216  C  {}  25.28  {}  17.472  {}  17.472  H  {}  C  {}  17.472  {}  23.744  {}  32  C  {}  41.6  {}  45.696  {}  45.696  H  {}  C  {}  52.864  {}  55.872  {}  55.872  H  {}  V  64  H  {}  Z  M  {}  32.448  C  {}  28.096  {}  25.664  {}  25.664  H  {}  C  {}  25.664  {}  29.76  {}  38.912  H  {}  C  {}  38.912  {}  36.864  {}  32.448  Z ',
        formatValues: [
            31.7335, 44.7895, 52.8535, 52.8535, 52.8535, 44.7895, 31.7335,
            16.5655, 8.3095, 3.1255, 3.1255, 3.1255, 8.1175, 16.5655, 44.3415,
            43.0615, 38.7095, 31.7335, 8.3735, 31.7335, 11.3815, 11.3815,
            13.8775, 17.9095, 31.7335, 39.6055, 44.0855, 44.6615, 17.9095,
            13.8135, 11.3815, 11.3815,
        ],
    },
    '+': {
        padding: 4.43825,
        width: 36.09605,
        formatString:
            ' M  {}  58.432  V  43.008  H  {}  V  37.632  H  {}  V  22.272  H  {}  V  37.632  H  {}  V  43.008  H  {}  V  58.432  H  {}  Z ',
        formatValues: [
            25.2383, 40.5343, 25.2383, 19.7983, 4.43825, 19.7983, 25.2383,
        ],
    },
    '-': {
        padding: 1.88725,
        width: 15.36005,
        formatString: ' M  {}  43.072  V  37.632  H  {}  V  43.072  H  {}  Z ',
        formatValues: [17.2473, 1.88725, 17.2473],
    },
    '=': {
        padding: 4.43825,
        width: 36.09605,
        formatString:
            ' M  {}  34.432  V  29.056  H  {}  V  34.432  H  {}  Z  M  {}  51.712  V  46.336  H  {}  V  51.712  H  {}  Z ',
        formatValues: [40.5343, 4.43825, 40.5343, 40.5343, 4.43825, 40.5343],
    },
    ' ': {
        padding: 0,
        width: 19,
        formatString: '',
        formatValues: [],
    },
};

function format(
    str: string,
    args: number[],
    callback: (x: number) => number = (x) => x,
) {
    var i: number = 0;
    return str.replace(/{}/g, (substr) => {
        if (i >= args.length) return '';
        return callback(args[i++]).toString();
    });
}

function expressionToSVG(expression: string): string {
    let path: string = '';
    let offset: number = 0;
    let width: number = 0;
    for (let char of expression) {
        const element: CharacterFormat | undefined = CharacterFormatMap[char];
        if (!element) throw 'Invalid character';
        path += format(
            element.formatString,
            element.formatValues,
            (x) => x + offset,
        );
        // console.log(offset)
        offset += element.width + element.padding * 2;
    }

    return `<svg width="100%" viewBox="0 0 ${offset} 77" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="${path}" fill="black"/></svg>`;
}

export default expressionToSVG;
export { expressionToSVG };
